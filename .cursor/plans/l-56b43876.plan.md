<!-- 56b43876-e22e-4073-bdbb-84246c183d2a 62e6a921-5d8d-4e81-a4f4-a9aecfedc900 -->
# LMS Core Build Plan (Django + DRF + React)

## Stack

- Backend: Django 5 + Django REST Framework; SQLite for local dev, PostgreSQL in deploy
- Frontend: React (Vite + TypeScript), Tailwind CSS
- Auth: Django auth + DRF JWT (access/refresh), role-based permissions
- Deployment: Frontend on Vercel, Backend on Railway (or Render). Optional Docker for local.

## Scope (MVP first, then iterate)

- MVP (deliver first):
- Auth: login/logout with roles (admin, librarian, member)
- Catalog: add/edit/list books, availability tracking (copies_total/available)
- Circulation: borrow and return endpoints + simple staff screens
- Iteration 2:
- Search filters (author/title/isbn), pagination
- Basic reports (circulation summary, top borrowed)
- Iteration 3:
- Email reminders and fines calculation
- User management screen (create member)

## Architecture

- Three-tier: API (`server/`), SPA (`client/`), DB
- API under `/api/*`; JWT auth; REST JSON
- Domain modules: `users`, `catalog`, `circulation`, `reports`

## Backend Structure (key files)

- `server/manage.py`
- `server/core/settings.py` (env-based settings, CORS, DRF, JWT)
- `server/users/models.py` (custom `User` with role enum)
- `server/catalog/models.py` (`Book`, `Category`)
- `server/circulation/models.py` (`BorrowRecord`)
- `server/*/serializers.py`, `views.py`, `urls.py`, `permissions.py`

## Data Model

- `users_user`: id, username, password_hash, email, role ∈ {ADMIN, LIBRARIAN, MEMBER}
- `catalog_book`: id, title, author, isbn (unique), category, year, copies_total, copies_available, status
- `circulation_borrowrecord`: id, user_id, book_id, borrow_date, due_date, return_date, fine_amount

## API Endpoints (essentials)

- Auth: `POST /api/auth/login`, `POST /api/auth/refresh`, `GET /api/auth/me`
- Users: `GET /api/users/` (admin), `POST /api/users/` (admin/librarian)
- Catalog: `GET /api/books`, `POST /api/books`, `GET /api/books/:id`, `PATCH /api/books/:id`
- Search: `GET /api/search?q&author&isbn&category&available`
- Circulation: `POST /api/borrow`, `POST /api/return`
- Reports: `GET /api/reports/circulation-summary?range=day|week|month`, `GET /api/reports/top-borrowed?limit=10`

## Frontend Pages (SPA)

- Auth: Login, Protected routes
- Catalog: Book list with filters, Book details
- Circulation (staff): Borrow/Return desk views
- Admin/Librarian: Add/Edit Book, Manage Users
- Reports: Simple tables/charts

## Non-Functional

- Security: JWT, role-permissions, server-side validation, CORS
- Accessibility: keyboard nav, contrast; responsive UI
- Performance: indexed fields, pagination
- Testing: unit tests for models/permissions; API tests for borrow/return

## Deliverables

- `server/` and `client/` source
- `.env.example` for both, with sensible defaults (SQLite locally)
- Seed script for demo data
- README with exact run and deploy commands

## Setup (local + deploy)

### Local quickstart (no Docker)

- Backend (SQLite by default for zero-config):
- `python -m venv venv`
- `venv\Scripts\activate` (Windows) or `source venv/bin/activate` (macOS/Linux)
- `pip install -r requirements.txt`
- `cp .env.example .env` (keeps SQLite; set `DJANGO_SECRET_KEY` if desired)
- `python manage.py migrate`
- `python manage.py createsuperuser` (optional)
- `python manage.py runserver` → `http://127.0.0.1:8000`
- Frontend:
- `cd client && npm i`
- `cp .env.example .env` and set `VITE_API_URL=http://127.0.0.1:8000`
- `npm run dev` → `http://127.0.0.1:5173`

### Local with Docker (optional)

- `docker compose up --build`
- Frontend at `http://localhost:5173`, API at `http://localhost:8000`

### Deploy

- Frontend → Vercel
- In Vercel, import `client/` as a project
- Env: `VITE_API_URL=https://<your-backend-host>`
- Build command: `npm run build`; Output dir: `dist`
- Backend → Railway (or Render)
- Create a new service from `server/`
- Env vars: `DJANGO_SECRET_KEY`, `DJANGO_ALLOWED_HOSTS=*`, `CORS_ALLOWED_ORIGINS=https://<your-vercel-domain>`, `DATABASE_URL` (Postgres from platform)
- Migrate: `python manage.py migrate`
- Start: `gunicorn core.wsgi:application --bind 0.0.0.0:8000`
- CORS presets allow localhost (dev) and your Vercel domain (prod)
- Note: Full Django on Vercel is non-trivial; Railway/Render keeps backend simple and stable.

### To-dos

- [ ] Initialize Django project, DRF, JWT, settings, CORS, Postgres env
- [ ] Implement User (roles), Book, BorrowRecord models and migrations
- [ ] Role-based permissions for admin/librarian/member across views
- [ ] Build CRUD for books, auth endpoints, search, borrow and return APIs
- [ ] Add circulation summary and top borrowed report endpoints
- [ ] Scaffold React + Vite + TS + Tailwind, auth flow, protected routes
- [ ] Implement catalog list/detail, add/edit book, borrow/return screens
- [ ] Write key unit/API tests; add seed script and README commands